' Gambas class file

'#################################################
' Software sotto licenza GPL v3 o superiore
' Software under GPL v3 o more licence
' Francesco "Ceskho OpenCode" Apruzzese
' per info o segnalazioni scrivere a :
' cescoap@gmail.com
'#################################################

$data AS String
$Lottery AS String
$Winned AS String
$Played AS String
$Note AS String
fPlayed AS Float
fWinned AS Float
$Edit AS Boolean
$Index AS Integer

PUBLIC SUB _new(pData AS String, pLottery AS String, pPlayed AS String, pWinned AS String, pNote AS String, pEdit AS Boolean, pIndex AS Integer)
  
  $data = pData
  $Lottery = pLottery
  $Played = Replace(pPlayed, "€", "")
  $Played = Replace($Played, ",", ".")
  $Winned = Replace(pWinned, "€", "")
  $Winned = Replace($Winned, ",", ".")
  fPlayed = CFloat($Played)
  fWinned = CFloat($Winned)
  $Note = pNote
  $Edit = pEdit
  $Index = pIndex
  
END


PUBLIC SUB Form_Open()

  ME.Center
  Label1.Text = Management.$value
  Label2.Text = Management.$value

  '-- fill combobox with lotteries names
  cbLottery.Add("Lotto", 0)
  cbLottery.Add("Superenalotto", 1)
  cbLottery.Add("10&Lotto", 2)
  cbLottery.Add("Win4Life", 3)

  '-- set the initial voice of the combobox
  IF $Edit THEN 
    cbLottery.Text = $Lottery
    IF Right(Left($data, 4)) = "0" THEN
      DateChooser1.Month = CInt(Right(Left($data, 5)))
    ELSE
      DateChooser1.Month = CInt(Right(Left($data, 4), 2))
    END IF
    DateChooser1.Year = CInt("20" & Right($data, 2))
    DateChooser1.Day = CInt(Left($data, 2))
    ValueBox1.Value = fPlayed
    ValueBox2.Value = fWinned
    TextArea1.Text = $Note
  END IF

END

PUBLIC SUB btSave_Click()

  DIM $hConn AS NEW Connection
  DIM sql AS String
  DIM hres AS Result
  
  IF $Edit THEN 
    Management.EditDatabase($Index, Str(DateChooser1.Value), cbLottery.Text, Str(ValueBox1.Value), Str(ValueBox2.Value), TextArea1.Text)
    ME.CLOSE 
  END IF
  
  WITH $hConn
  .Type = Management.DatabaseType
  .Host = Management.DatabasePath
  END WITH

  $hConn.Name = Management.DatabaseName
  $hConn.Open

  $hconn.Begin

  hres = $hconn.Create(Management.DatabaseTableName)  'collega il result hres alla tavola prova in modalità creazione record

  'hres!data = CInt(Replace(Str(DateChooser1.Value), "/", ""))
  hres!data = Right(Str(DateChooser1.Year), 2) & Format$(DateChooser1.Month, "00") & Format$(DateChooser1.day, "00")
  hres!used = Str(ValueBox1.Value)
  hres!win = Str(ValueBox2.Value)
  hres!note = TextArea1.Text
  hres!lottery = cbLottery.Text

  hres.Update

  $hConn.Commit
  $hConn.Close
  
  ME.Close

END

PUBLIC SUB btClose_Click()

  ME.Close

END
