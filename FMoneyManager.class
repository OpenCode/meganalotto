' Gambas class file

'#################################################
' Software sotto licenza GPL v3 o superiore
' Software under GPL v3 o more licence
' Francesco "Ceskho OpenCode" Apruzzese
' per info o segnalazioni scrivere a :
' cescoap@gmail.com
'#################################################

PUBLIC SUB btAdd_Click()

  FMoneyManagerAdd.ShowDialog()

END

PUBLIC SUB Form_Resize()

  GridView1.Columns.Count = 4
  GridView1.Columns[0].Text = ("Data")
  GridView1.Columns[0].Width = GridView1.w / 4
  GridView1.Columns[1].Text = ("Importo giocato")
  GridView1.Columns[1].Width = GridView1.w / 4
  GridView1.Columns[2].Text = ("Importo vinto")
  GridView1.Columns[2].Width = GridView1.w / 4
  GridView1.Columns[3].Text = ("Note")
  GridView1.Columns[3].Width = GridView1.w / 4

END

PUBLIC SUB bRefresh_Click()

  DIM $hConn AS NEW Connection
  DIM hres AS Result
  DIM sql, $data AS String
  DIM i AS Integer

  GridView1.Clear()
  
  WITH $hConn
    .Type = Management.DatabaseType
    .Host = Management.DatabasePath
  END WITH

  $hConn.Name = Management.DatabaseName
  $hConn.Open

  sql = "SELECT * FROM money WHERE data BETWEEN " & CInt(Replace(Str(DateChooser1.Value), "/", "")) & " AND " & CInt(Replace(Str(DateChooser2.Value), "/", ""))
  ' FUNZIONA! sql = "SELECT * FROM money WHERE data LIKE " & CInt(Replace(Str(DateChooser1.Value), "/", ""))

  hres = $hconn.Exec(sql)

  IF hres.Available = TRUE THEN
      GridView1.Columns.Count = 4
      GridView1.Rows.Count = hres.Count
      i = 0
      FOR EACH hres
        $data = Str(hres!data)
        $data = Left($data, 2) & "/" & Right(Left($data, 4), 2) & "/" & Right($data, 2)
        GridView1[i, 0].Text = $data
        GridView1[i, 1].Text = hres!used & Management.$value
        GridView1[i, 2].Text = hres!win & Management.$value
        GridView1[i, 3].Text = hres!note
        INC i
      NEXT
  ELSE
        GridView1.Columns.Count = 1
        GridView1.Rows.Count = 1
        GridView1[0, 0].Text = ("Nessun dato trovato!")
        GridView1[0, 0].Alignment = Align.Center
  END IF

END
